<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>사이버 편지 서비스</title>

  <style>
    @font-face {
      font-family: 'GasiGasiBaekMinju';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2112@1.0/establishThornFontOTF.woff') format('woff');
      font-weight: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'OngleipParkDahyeon';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2411-3@1.0/Ownglyph_ParkDaHyun.woff2') format('woff2');
      font-weight: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Yeongwol';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2507-2@1.0/YeongwolTTF-Regular.woff2') format('woff2');
      font-weight: normal;
      font-display: swap;
    }

    body {
      font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans KR", sans-serif;
      margin:0; padding:24px;
      background:#0b0c10; color:#f4f7fb;
    }
    * { box-sizing: border-box; }

    .container { display:flex; gap:48px; align-items:flex-start; }
    .form { flex:0 0 250px; }
    label { display:block; margin-bottom:16px; }
    input { width:100%; height:28px; line-height:1.6; }
    .papers, .fonts { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-bottom:16px; }
    .paper-btn, .font-btn { height:36px; border:1px solid #555; background:#15181f; color:#f4f7fb; cursor:pointer; }
    .paper-btn.active, .font-btn.active { background:#f4f7fb; color:#15181f; border-color:#f4f7fb; }

    #monitor {
      width:500px; height:500px; border:1px solid #ffffff;
      padding:50px; line-height:1.6; font-size:2rem;
      background-size:cover; background-position:center; background-repeat:no-repeat;
      color:#0000ff; display:flex; flex-direction:column; justify-content:space-between;
    }
    .msg { margin-top:12px; }
    .footer { display:flex; justify-content:space-between; margin-top:8px; }
    #save { margin-top:8px; height:36px; border:1px solid #555; background:#f4f7fb; color:#15181f; cursor:pointer; }
  </style>
</head>
<body>
<div class="container">
  <div class="form">
    <label>[사이버 편지 서비스]</label>

    <label>편지지 선택 :</label>
    <div class="papers" id="papers">
      <button class="paper-btn" data-bg="normal.jpg">일반편지</button>
      <button class="paper-btn" data-bg="award.jpg">칭찬편지</button>
      <button class="paper-btn" data-bg="heart.jpg">고백편지</button>
      <button class="paper-btn" data-bg="breakup.jpg">이별편지</button>
      <button class="paper-btn" data-bg="party.jpg">생일편지</button>
      <button class="paper-btn" data-bg="apology.jpg">사과편지</button>
      <button class="paper-btn" data-bg="menu.jpg">저메추</button>
      <button class="paper-btn" data-bg="pooky.jpg">협박편지</button>
    </div>

    <label>서체:</label>
    <div class="fonts" id="fonts">
      <button class="font-btn" data-font="inherit">기본</button>
      <button class="font-btn" data-font="'OngleipParkDahyeon', cursive">손글씨</button>
      <button class="font-btn" data-font="'Yeongwol', serif">붓글씨</button>
      <button class="font-btn" data-font="'GasiGasiBaekMinju', serif">가시</button>
    </div>

    <label>서체색 : <input id="c" type="color" value="#FF0000"></label>
    <label>발신인 : <input id="t1" type="text"></label>
    <label>수신인 : <input id="t2" type="text"></label>
    <label>작성일 : <input id="d" type="date" value="2025-09-24"></label>
    <label>내용 : <input id="t3" type="text" placeholder="내용을 입력하세요."></label>
  </div>

  <div>
    <div id="monitor"></div>
    <button id="save">이미지 저장</button>
  </div>
</div>

<script>
  const monitor = document.getElementById('monitor');
  const papers = document.getElementById('papers');
  const fonts = document.getElementById('fonts');
  const c = document.getElementById('c');
  const t1 = document.getElementById('t1');
  const t2 = document.getElementById('t2');
  const t3 = document.getElementById('t3');
  const d  = document.getElementById('d');
  const saveBtn = document.getElementById('save');

  papers.querySelectorAll('.paper-btn').forEach(btn=>{
    btn.onclick = function(){
      papers.querySelectorAll('.paper-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      monitor.style.backgroundImage = "url('" + btn.dataset.bg + "')";
    };
  });

  // 폰트 버튼 선택 (순서 및 라벨 유지)
  let currentFont = "inherit";
  fonts.querySelectorAll('.font-btn').forEach(btn=>{
    btn.onclick = function(){
      fonts.querySelectorAll('.font-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentFont = btn.dataset.font;
      update();
    };
  });

  function update(){
    monitor.style.color = c.value || "#0000ff";
    monitor.style.fontFamily = currentFont || "inherit";

    monitor.innerHTML =
      "<p>To " + (t2.value || "") + "</p>" +
      "<div class='msg'>" + (t3.value || "") + "</div>" +
      "<div class='footer'>" +
        "<span class='left'>" + (d.value || "") + "</span>" +
        "<span class='right'>From " + (t1.value || "") + "</span>" +
      "</div>";
  }

[t1,t2,t3,c,d].forEach(el=>el.oninput = update);
update();

saveBtn.onclick = function () {
  const W = 500, H = 500, P = 50;
  const canvas = document.createElement("canvas");
  canvas.width = W; canvas.height = H;
  const ctx = canvas.getContext("2d");

  ctx.fillStyle = "#ffffff";
  ctx.fillRect(0, 0, W, H);

  const m = (monitor.style.backgroundImage || "").match(/url\(["']?(.*?)["']?\)/);
  const bgSrc = m && m[1] ? m[1] : "";

  function drawTextAndSave() {
    const go = () => {
      ctx.fillStyle = c.value || "#0000ff";
      ctx.textBaseline = "top";
      ctx.font = "24px " + (currentFont || "inherit");

      const bodyY = P

      ctx.fillText("To " + (t2.value || ""), P, P);
      ctx.fillText((t3.value || ""), P, P + 20);
      ctx.fillText((d.value || ""), P, H - P - 30);

      const fromText = "From " + (t1.value || "");
      const tw = ctx.measureText(fromText).width;
      ctx.fillText(fromText, W - P - tw, H - P - 30);

      const a = document.createElement("a");
      a.href = canvas.toDataURL("image/png");
      a.download = "letter.png";
      document.body.appendChild(a);
      a.click();
      a.remove();
    };

    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(go);
    } else {
      go();
    }
  }

  if (bgSrc) {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = function () {
      const rImg = img.width / img.height, rBox = W / H;
      let dw = W, dh = H, dx = 0, dy = 0;
      if (rImg > rBox) { dh = H; dw = H * rImg; dx = (W - dw) / 2; }
      else { dw = W; dh = W / rImg; dy = (H - dh) / 2; }
      ctx.drawImage(img, dx, dy, dw, dh);
      drawTextAndSave();
    };
    img.onerror = drawTextAndSave; // 이미지 못 불러오면 배경 없이 진행
    img.src = bgSrc;
  } else {
    drawTextAndSave(); // 배경 없으면 바로 텍스트
  }
};

</script>
</body>
</html>
